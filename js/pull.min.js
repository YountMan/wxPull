var pull={config:{elID:"",upMessageID:"",downMessageID:"",upPullToLoadMore:"上拉加载",upReleaseToRefresh:"松开加载",upRefreshing:"加载中…",upIsLastMessage:"已经是最后一页",downPullToRefresh:"下拉刷新",downReleaseToRefresh:"松开刷新",downRefreshing:"刷新中…",threshold:60,maxOffset:150,actionOffset:60,method:"up,down",upCallback:null,downCallback:null,totalRecords:0,pageSize:20},status:{hasTouch:"ontouchstart"in window,start:0,end:0,offset:0,direction:"",isLock:false,isCanMove:false,message:"",startScrollTop:0,page:1,isLast:false},isLastPage:function(){this.status.isLast=this.config.totalRecords<this.status.page*this.config.pageSize+1},init:function(option,callback){if(typeof option=="object"){this.config=this.extend(this.config,option)}var el=document.querySelector(this.config.elID);var _this=this;el.addEventListener("touchstart",function(e){_this.touchStart(e)});el.addEventListener("touchmove",function(e){_this.touchMove(e)});el.addEventListener("touchend",function(e){_this.touchEnd(e)})},touchStart:function(e){this.setPositionOriginal();this.status.direction="";this.isLastPage();console.log("最后一页:"+this.status.isLast);this.status.isLock=true;this.status.isCanMove=true;var even=typeof event=="undefined"?e:event;this.status.start=this.status.hasTouch?even.touches[0].pageY:even.pageY;var ele=document.querySelector(this.config.elID);var scrollTop=ele.parentNode.scrollTop;this.status.startScrollTop=scrollTop},touchMove:function(e){var even=typeof event=="undefined"?e:event;this.status.end=this.status.hasTouch?even.touches[0].pageY:even.pageY;this.status.offset=this.status.end-this.status.start;var ele=document.querySelector(this.config.elID);var eleParent=ele.parentNode;var scrollTop=eleParent.scrollTop;this.setTransition(0);if(scrollTop>=0&&scrollTop<=ele.clientHeight-eleParent.clientHeight+1){eleParent.scrollTop=eleParent.scrollTop-this.status.offset}if(this.status.direction==""){this.status.direction=this.status.offset>0?"down":"up"}if(scrollTop==0&&this.status.direction=="down"){this.touchMoveDown()}if(scrollTop+1>=ele.clientHeight-eleParent.clientHeight&&this.status.direction=="up"){this.touchMoveUp()}},touchMoveUp:function(){var ele=document.querySelector(this.config.elID);var scrollBottom=ele.clientHeight-ele.parentNode.clientHeight;var transVal=-this.status.offset-(scrollBottom-this.status.startScrollTop);if(this.status.isLast){this.status.message=this.config.upIsLastMessage;this.setMessage();if(transVal>this.config.threshold){var diff=-transVal+this.config.threshold;if(-diff>this.config.actionOffset){diff=-this.config.actionOffset}this.setTransition(0);this.translate(diff)}}else{this.status.message=this.config.upPullToLoadMore;this.setMessage();if(transVal>this.config.threshold){var diff=-transVal+this.config.threshold;if(-diff>this.config.actionOffset){this.status.message=this.config.upReleaseToRefresh;if(-diff>this.config.maxOffset){diff=-this.config.maxOffset}}this.setTransition(0);this.translate(diff)}this.setMessage()}},touchMoveDown:function(){if(this.status.offset>this.config.threshold+this.status.startScrollTop){console.log("offset:"+this.status.offset);var transVal=this.status.offset-(this.config.threshold+this.status.startScrollTop);if(transVal>this.config.maxOffset)transVal=this.config.maxOffset;this.translate(transVal);this.status.message=this.config.downPullToRefresh;if(transVal>this.config.actionOffset){this.status.message=this.config.downReleaseToRefresh}this.setMessage()}},touchEnd:function(e){if(this.status.isCanMove){if(this.status.direction=="down"){this.touchEndDown()}if(this.status.direction=="up"){this.touchEndUp()}this.status.isCanMove=false;this.setTransition(1);this.back(0)}},touchEndDown:function(){var transVal=this.status.offset-(this.config.threshold+this.status.startScrollTop);if(transVal>this.config.actionOffset){this.status.message=this.config.downRefreshing;this.setMessage();if(typeof this.config.downCallback=="function"){this.config.downCallback()}}},touchEndUp:function(){var ele=document.querySelector(this.config.elID);var scrollBottom=ele.clientHeight-ele.parentNode.clientHeight;var transVal=-this.status.offset-(scrollBottom-this.status.startScrollTop);if(transVal>this.config.threshold){if(!this.status.isLast){if(transVal>this.config.actionOffset+this.config.threshold){this.status.message=this.config.upRefreshing;this.setMessage();if(typeof this.config.upCallback=="function"){this.config.upCallback();this.status.page++}}}this.setTransition(1);this.back(0)}},setPositionOriginal:function(){var ele=document.querySelector(this.config.elID);this.setTransition(0);var direct=this.status.direction;if(direct=="up"&&this.config.method.indexOf("up")>-1){var ele1=document.querySelector(this.config.upMessageID);ele1.className="";this.status.message=this.config.upPullToLoadMore;this.setMessage()}if(direct=="down"&&this.config.method.indexOf("down")>-1){var ele1=document.querySelector(this.config.downMessageID);ele1.className="";this.status.message=this.config.downPullToRefresh;console.log("set message");this.setMessage()}},setTransition:function(time){var ele=document.querySelector(this.config.elID);ele.style.webkitTransition="all "+time+"s";ele.style.transition="all "+time+"s";if(this.status.direction){var eleID1=this.status.direction=="up"?this.config.upMessageID:this.config.downMessageID;eleID1=document.querySelector(eleID1);eleID1.style.webkitTransition="all "+time+"s";eleID1.style.transition="all "+time+"s"}},translate:function(diff){var ele=document.querySelector(this.config.elID);ele.style.webkitTransform="translate(0,"+diff+"px)";ele.style.transform="translate(0,"+diff+"px)";var eleID1=this.status.direction=="up"?this.config.upMessageID:this.config.downMessageID;eleID1=document.querySelector(eleID1);eleID1.style.height=Math.abs(diff)+"px"},back:function(offset){this.translate(0-offset);this.status.isLock=false;this.status.isCanMove=false},setMessage:function(){if(this.status.direction=="up"){var ele=document.querySelector(this.config.upMessageID);ele.querySelector(".txt").innerText=this.status.message}if(this.status.direction=="down"){var ele=document.querySelector(this.config.downMessageID);ele.querySelector(".txt").innerText=this.status.message}},extend:function(){var length=arguments.length;var target=arguments[0]||{};if(typeof target!="object"&&typeof target!="function"){target={}}if(length==1){target=this}for(var i=1;i<length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target}};